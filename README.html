<h1>Custom Post Type Directory (Version 2)</h1>

<h2>Run <code>git checkout master</code> for Version 1</h2>

<p>Directory management system based on Custom Post Types, Taxonomies, and Fields</p>

<h2>Features</h2>

<ul>
<li>Creates custom post type and taxonomies from backend without coding</li>
</ul>

<hr />

<h2>Notes</h2>

<ul>
<li><p>Default behaviors for front end field display are not well-defined without Advanced Custom Fields plugin.  Using ACF adds support for field placement and ordering on single/archive pages for your various post types as well as field type selection.</p></li>
<li><p>Uses <a href="https://github.com/johnbillion/extended-cpts">Extended Custom Post Types</a> and <a href="https://github.com/johnbillion/extended-taxos">Extended Taxonomies</a> for registering post types and taxonomies.</p></li>
<li><p>Uses <a href="https://github.com/WebDevStudios/CMB2">CMB2</a> for handling post meta boxes.</p></li>
<li><p>Giving a field a key of <code>web</code>, <code>website</code>, or <code>url</code> will cause the field value to autolink on front end CPTD views</p></li>
</ul>

<hr />

<h2>Shortcodes</h2>

<hr />

<h2>Filters</h2>

<h3><code>cptd_register_pt</code></h3>

<h4>Description</h4>

<p>Use this filter to access the post type data before CPTD post types are registered.  The filtered object is an array
containing the arguments for <a href="https://github.com/johnbillion/extended-cpts/wiki/Basic-usage">register_extended_post_type</a>, which is a wrapper for <a href="https://codex.wordpress.org/Function_Reference/register_post_type">register_post_type</a>.</p>

<h4>Parameters</h4>

<pre><code>$cpt = array(
    'post_type' =&gt; (string),
    'args' =&gt; (array, optional),    // The arguments for `register_post_type`
    'names' =&gt; (array, optional)    // The corresponding parameter for `register_extended_post_type`
)
</code></pre>

<h4>Example</h4>

<pre><code>add_filter( 'cptd_register_pt', 'my_register_pt' );
function my_register_pt( $args ) {

    if( $cpt['post_type'] == 'my_post_type' )
        $cpt['args']['labels']['menu_name'] = 'Custom Menu Name';

    return $cpt;
}
</code></pre>

<hr />

<h3><code>cptd_the_content</code></h3>

<h4>Description</h4>

<p>Use this filter to modify the post content for CPTD views.  Does not fire for non-CPTD page views.</p>

<h4>Parameters</h4>

<pre><code>$content: The post content along with any appended fields for the current view
</code></pre>

<h4>Return</h4>

<pre><code>(string) You must return the altered HTML to be displayed
</code></pre>

<h4>Example</h4>

<p>Below, we're appending an additional field called <code>phone</code> below the default fields and post content.</p>

<pre><code>add_filter( 'cptd_the_content', 'my_the_content' );
function my_the_content( $content ) {

    global $post;

    $phone = get_post_meta( $post-&gt;ID, 'phone', true );
    if( $phone ) $new_html = '&lt;p&gt;Phone: '. $phone .'&lt;/p&gt;':

    return $content . $new_html;
}
</code></pre>

<hr />

<h3><code>cptd_field_value_{$field_name}</code></h3>

<p>Use this to filter a field value before it is displayed on the front end. Use your own field name (meta key) in place of <code>{$field_name}</code>. </p>

<h4>Parameters</h4>

<pre><code>$value: The field value to be displayed
</code></pre>

<h4>Return</h4>

<pre><code>(string) You must return the altered field value
</code></pre>

<h4>Example</h4>

<p>Below, we are filtering the value of a field called <code>email</code> and adding a mailto link.</p>

<pre><code>add_filter( 'cptd_field_email', 'my_email_filter' );
function my_email_filter( $value ){

    $value = "&lt;a href='mailto:". $value . "' &gt;" . $value . "&lt;/a&gt;";
    return $value;

}
</code></pre>

<hr />

<h2>Actions</h2>

<h3><code>cptd_pre_get_posts</code></h3>

<p>Use this action to alter the global <code>$wp_query</code> for CPTD views.  It's essentially the same as <code>pre_get_posts</code>, except CPTD defaults are in place.  Also, there is no need to check whether we're viewing a page for a CPTD object or whether the query is the main query object, as this has been verified before the filter fires.  </p>

<p>Below are the default query arguments for a CPTD view:</p>

<ul>
<li><code>order_by</code>: post_title</li>
<li><code>order</code>: ASC</li>
</ul>

<h4>Parameters</h4>

<pre><code>$query: The same value passed by WP's `pre_get_posts` action, with the CPTD defaults in place
</code></pre>

<h4>Example</h4>

<p>Below, we are using the <code>cptd_pre_get_posts</code> filter to order CPTD posts by a field called <code>last_name</code></p>

<pre><code>add_action( 'cptd_pre_get_posts', 'my_pre_get_posts' );
function my_pre_get_posts( $query ) {

    $query-&gt;query_vars['orderby'] = 'meta_value';
    $query-&gt;query_vars['meta_key'] = 'last_name';
}
</code></pre>

<h3><code>cptd_pre_render_field_{$field_name}</code></h3>

<h3><code>cptd_post_render_field_{$field_name}</code></h3>

<p>These actions allow users to insert their own HTML before (<em>pre</em>) or after (<em>post</em>) a field is rendered.  Use your own field name (meta key) in place of <code>{$field_name}</code>.  Note that the action fires whether or not the field has a value.</p>

<h3>Parameters</h3>

<p><code>$field</code> (CPTD_Field) The field object being displayed</p>

<h3>Example</h3>

<p>Below is an example to wrap a field called <code>email</code> in a div. Note the example doesn't use the <code>$field</code> object, although it is available inside the function.</p>

<pre><code>add_action('cptd_pre_render_field_email', 'my_pre_email');
add_action('cptd_post_render_field_email', 'my_post_email');

function my_pre_email( $field ){
?&gt;
    &lt;div id='my-email-field' class='my-custom-class' &gt;
&lt;?php
}

function my_post_email( $field ){
?&gt;
    &lt;/div&gt;
&lt;?php
}
</code></pre>

<hr />

<h2>Functions</h2>

<p>Here are some helper functions that you can call within your child theme</p>

<h3><code>is_cptd_view()</code></h3>

<p>Returns <code>true</code> if we are viewing a CPTD object and <code>false</code> otherwise.</p>